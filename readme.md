ソースコードはこちらから拝借させて頂きました。
https://loumo.jp/wp/archive/20180608120023/